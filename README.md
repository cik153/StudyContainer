# Network Basic Concepts (IP / Subnet / L2 / L3)

## 0) 네트워크 7계층 (OSI 7 Layers)
OSI 7계층은 네트워크 통신을 **기능 단위로 나눠 설명**하기 위한 모델이다. 실제 인터넷은 TCP/IP 모델로 동작하지만, **문제 원인 파악/설계 설명**에 OSI가 자주 쓰인다.

| Layer | 이름 | 주요 역할 | 대표 예시 | 장비/개념 |
|---|---|---|---|---|
| 7 | Application | 사용자/프로그램이 사용하는 네트워크 서비스 | HTTP, HTTPS, DNS, SSH | 브라우저, 서버 앱 |
| 6 | Presentation | 표현/인코딩/암호화/압축 | TLS/SSL, UTF-8, JPEG | (주로 라이브러리/프로토콜) |
| 5 | Session | 세션 관리(연결 유지/동기화) | RPC 세션 개념 등 | (주로 소프트웨어) |
| 4 | Transport | 종단 간 전송, 포트, 신뢰성/흐름 제어 | TCP, UDP | L4 LB(로드밸런서) |
| 3 | Network | IP 기반 라우팅, 서브넷, 경로 선택 | IPv4/IPv6, ICMP | 라우터, L3 스위치 |
| 2 | Data Link | MAC 기반 프레임 전달, VLAN, 로컬 전달 | Ethernet(802.3), 802.1Q, ARP(IPv4에서 L2.5 느낌) | L2 스위치 |
| 1 | Physical | 전기/광 신호, 케이블/무선, 비트 전송 | UTP, Fiber, Wi-Fi PHY | 허브(개념상), 케이블 |

> 참고  
> - **ARP**는 IPv4에서 “IP→MAC 해석”이라 L2와 L3 사이(흔히 L2.5라고도)로 설명되기도 한다.  
> - 실무에서는 “L2 문제인지(LAN/VLAN/MAC), L3 문제인지(IP/라우팅)”를 이 모델로 빠르게 분리한다.

---

## 1) IP 주소 (IPv4)
- **IP 주소**는 네트워크에서 “어디로 보낼지”를 판단하기 위한 **논리적(L3) 주소**다.
- IPv4는 `192.168.1.150`처럼 **점-십진 표기(dotted decimal notation)** 를 사용한다.
  - `192`, `168`, `1`, `150` 각각은 **옥텟(octet)** = **8비트(0~255)** 단위다.

---

## 2) 서브넷(Subnet) / 서브넷 마스크(Subnet Mask)
### 왜 필요한가?
서브넷은 “목적지 IP가 **내 로컬 네트워크인가?** 아니면 **게이트웨이(라우터)로 보내야 하는가?**”를 판단하기 위한 **주소 그룹(프리픽스)** 이다.  
즉, **라우팅(경로 결정)의 기본 단위**다.

### 네트워크 주소 / 브로드캐스트 주소 / 호스트 범위
서브넷 마스크(또는 프리픽스 `/24`, `/16` 등)를 적용하면 아래가 결정된다.
- **네트워크(서브넷) 주소**
- **브로드캐스트 주소(IPv4)**
- **사용 가능한 호스트 범위**

#### 예시: `192.168.1.150/24` (= `255.255.255.0`)
- 네트워크 주소: `192.168.1.0`
- 브로드캐스트 주소: `192.168.1.255`
- 호스트 범위: `192.168.1.1 ~ 192.168.1.254`

> ✅ 주의  
> “앞의 3옥텟이 서브넷” 같은 표현은 **/24일 때만** 그렇게 보이는 습관적 표현이다.  
> 마스크가 바뀌면 네트워크/호스트 경계는 달라진다.

---

## 3) L2 스위치 (Switching, Layer 2)
### 역할
- L2 스위치는 **MAC 주소 기반**으로 이더넷 프레임을 전달한다.
- IP를 몰라도 동작하며, 핵심은 **같은 L2 네트워크(VLAN) 내 프레임 전달**이다.

### 이더넷 프레임(개념)
- 주요 필드
  - Destination MAC, Source MAC
  - EtherType (IPv4/IPv6 등)
  - Payload
  - VLAN Tag(802.1Q, 옵션)

### MAC 테이블(CAM Table)
- 스위치는 프레임을 수신하면 **Source MAC**을 보고 “이 MAC은 이 포트에 있음”을 학습한다.
- 목적지 MAC을 알고 있으면 해당 포트로 전달하고,
- 모르면(Unknown Unicast) 보통 이더넷 프레임이 들어온 VLAN 전체로 **플러딩**한다.
- 스위치에서 VLAN 설정이 있어서, 각 포트별로 VLAN을 다르게 설정할 수 있고, 설정이 없다면 하나의 VLAN으로 취급된다.

---

## 4) ARP / NDP (IP → MAC 해석)
### 왜 필요한가?
같은 VLAN(로컬 네트워크)에서 실제 전송은 **MAC 주소**로 이루어지는데, 목적지 IP만 알고 MAC을 모르면 **IP → MAC**을 알아내야 한다.

### ARP (IPv4)
- 같은 서브넷(같은 VLAN)의 목적지에게 보내려는데 MAC을 모르면:
  1. **ARP Request**: “이 IP(Target IP)를 가진 MAC 누구?”  
     - 이더넷 프레임의 **Destination MAC = FF:FF:FF:FF:FF:FF (브로드캐스트)**
  2. L2 스위치는 이 브로드캐스트 프레임을 **같은 VLAN의 모든 포트로 전달**한다. (일반적으로 수신 포트는 제외)
  3. 각 호스트는 ARP Request 페이로드의 **Target IP**를 확인하고,
     - Target IP가 자기 IP와 같으면 **ARP Reply**로 자신의 MAC을 응답한다.  
     - (Reply는 보통 **유니캐스트**, Destination MAC = 요청자 MAC)
  4. L2 스위치는 ARP Reply를 수신하면,
     - Reply 프레임의 **Source MAC(응답자 MAC)** 을 MAC 테이블에 학습하고
     - **Destination MAC(요청자 MAC)** 이 있는 포트로 Reply를 전달한다.
  5. 송신 호스트는 ARP Reply를 받아 **(Target IP ↔ Target MAC)** 매핑을 ARP 캐시에 저장하고,
     이후 데이터 프레임을 **목적지 MAC(상대 MAC)** 으로 만들어 전송한다.
     
### NDP (IPv6)
- IPv6는 ARP 대신 **NDP(Neighbor Discovery Protocol)** 를 사용한다.
- 브로드캐스트 대신 **ICMPv6 + 멀티캐스트** 기반으로 동작한다.  
  (IPv6에는 L2 브로드캐스트 기반 “ARP”가 없다)

- 같은 링크(같은 VLAN/세그먼트)에서 목적지에게 보내려는데 MAC(정확히는 IPv6에서의 L2 주소)을 모르면:
  1. 송신 호스트는 목적지 IPv6의 MAC을 알아내기 위해 **Neighbor Solicitation (NS)** 메시지를 보낸다.  
     - 프로토콜: **ICMPv6**
     - 목적지 MAC을 FF:FF:FF:FF:FF:FF로 뿌리지 않고,
       목적지 IPv6에 대응되는 **Solicited-Node 멀티캐스트 주소**로 보낸다.
  2. L2 스위치는 이 멀티캐스트 프레임을 VLAN 내에서 전달한다.  
     - (IGMP는 IPv4, IPv6에서는 **MLD(멀티캐스트 리스너 디스커버리)** 가 관련될 수 있음)
  3. 대상 호스트는 NS를 수신하면 **Neighbor Advertisement (NA)** 로 자신의 MAC을 응답한다.  
     - 보통 요청자에게 **유니캐스트**로 응답(환경에 따라 멀티캐스트로도 가능)
  4. 송신 호스트는 NA를 받아 **Neighbor Cache**(IPv6의 ARP 캐시 역할)에  
     `(대상 IPv6 ↔ 대상 MAC)` 매핑을 저장한 뒤 데이터 프레임을 전송한다.

> 참고: IPv6에서는 NDP가 “주소 해석”뿐 아니라 **Duplicate Address Detection(DAD)**,  
> **Router Solicitation/Advertisement(RS/RA)** 등 주소 설정/라우터 발견에도 사용된다.

---

## 5) L3 스위치 (Routing, Layer 3)
### 역할
- L3 스위치는 L2 스위칭 + **라우팅(L3 전달)** 기능을 함께 가진 장비다.
- **서로 다른 서브넷(VLAN) 간 통신**은 **라우팅이 필요**하다.

### 다른 서브넷으로 보낼 때 흐름(중요)
예: `192.168.1.150/24` → `192.168.2.10/24`

1. 송신 PC는 목적지 IP가 내 서브넷이 아니므로 **기본 게이트웨이(Default Gateway)** 로 보낸다.
2. 이때 PC가 알아내는 MAC은 목적지(192.168.2.10)의 MAC이 아니라,
   - **게이트웨이(라우터/L3 스위치의 SVI) MAC** 이다.
   - PC는 **게이트웨이 MAC을 목적지 MAC으로 하는 이더넷 프레임**을 만들어 전송한다.
3. 게이트웨이(라우터/L3 스위치)는 라우팅 테이블을 보고
   - 목적지 서브넷으로 나갈 인터페이스를 선택하고
   - 그 인터페이스에서 목적지(또는 다음 홉)의 MAC을 ARP/NDP로 알아낸 뒤 전달한다.

> ✅ 정리  
> - PC는 “다른 서브넷이면 게이트웨이로 보낸다”까지만 알면 된다.  
> - 이후 경로 선택/전달은 **라우터/L3 스위치**가 수행한다.

---

## 6) 브로드캐스트 / 멀티캐스트와 서브넷
### 브로드캐스트 (Broadcast)
- IPv4 브로드캐스트는 기본적으로 **서브넷(VLAN) 밖으로 라우팅되지 않는다.**
- 서브넷을 나누면 브로드캐스트 범위를 제한할 수 있다.
- 다만 서브넷은 브로드캐스트 때문만이 아니라,
  - **라우팅 단위**
  - **주소 설계/운영**
  - **보안 경계(정책 적용 지점)**
  - **트래픽/장애 범위 축소**
  등의 목적도 크다.

### 멀티캐스트 (Multicast)
- 같은 VLAN에서 멀티캐스트는 **라우터 없이도** 동작할 수 있다(스누핑이 없으면 플러딩될 수 있음).
- 효율/안정성을 위해 보통 다음이 사용된다.
  - **IGMP Snooping (L2)**: 가입한 포트로만 멀티캐스트 전달(트래픽 절감)
  - **IGMP Querier**: 멤버십 유지/갱신을 위한 Query 송신(보통 L3 장비가 수행, 또는 스위치 기능)
- **다른 VLAN/서브넷으로 멀티캐스트를 넘기려면**
  - 라우터/L3 스위치에서 **멀티캐스트 라우팅(PIM 등)** 설정이 필요하다.

---

## 헷갈리기 쉬운 포인트 (정리)
- “서브넷 주소 = 192.168.1.XXX”가 아니라, 서브넷은 보통 `192.168.1.0/24`처럼 **네트워크 주소 + 프리픽스**로 표현한다.
- L2 스위치는 IP가 아니라 **MAC 기반 프레임 전달** 장비다.
- 다른 서브넷으로 보낼 때 PC가 ARP로 찾는 대상은 “원격지 호스트 MAC”이 아니라 **게이트웨이 MAC**이다.
- (일반적인 설계에서) **VLAN 1개 = 서브넷 1개 = 브로드캐스트 도메인 1개**로 맞춘다.

---

## 추가로 알면 좋은 개념
- **Default Gateway**: 다른 네트워크로 나갈 때 사용하는 출구(다음 홉)
- **Routing Table**: 목적지 네트워크별로 “어디로 보낼지” 결정하는 표
- **MTU**: 한 번에 전송 가능한 최대 크기(조각화/성능 이슈와 연결)
- **NAT**: 사설 IP ↔ 공인 IP 변환 (라우팅과 함께 자주 등장)
